<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retrieving Destatis data • RUBer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Retrieving Destatis data">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RUBer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reference_docx.html">Formatting for the reference docx document</a>
    </li>
    <li>
      <a href="../articles/RUB_colors.html">Using RUB colors</a>
    </li>
    <li>
      <a href="../articles/RUB_plot.html">Using the RUB plotting functions</a>
    </li>
    <li>
      <a href="../articles/Wiesbaden.html">Retrieving Destatis data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RichardMeyer-Eppler/RUBer">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Retrieving Destatis data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RichardMeyer-Eppler/RUBer/blob/master/vignettes/Wiesbaden.Rmd"><code>vignettes/Wiesbaden.Rmd</code></a></small>
      <div class="hidden name"><code>Wiesbaden.Rmd</code></div>

    </div>

    
    
<p>This vignette will explain step-by-step how to retrieve entire table series and their associated labels from Destatis using the package <code>wiesbaden</code>. My aim with the approach described here is to make it easily adaptable to other use cases or table series. Feedback welcome!</p>
<div id="wiesbaden-setup" class="section level1">
<h1 class="hasAnchor">
<a href="#wiesbaden-setup" class="anchor"></a>Wiesbaden Setup</h1>
<p>First off, load the packages we will be using throughout this vignette.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(extrafont)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(forcats)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(janitor)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(RUBer)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tibble)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyselect)</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(wiesbaden)</a></code></pre></div>
<p>The R package <code>wiesbaden</code> by Moritz Marbach provides functions to directly retrieve data from databases maintained by the Federal Statistical Office of Germany (Destatis) in Wiesbaden. After installing the package with <code><a href="https://remotes.r-lib.org/reference/install_github.html">remotes::install_github("sumtxt/wiesbaden")</a></code>, you can check <code>vignette("using-wiesbaden", package = "wiesbaden")</code> for more info.</p>
<p>In order to retrieve data from the four available databases (<a href="https://www.bildungsmonitoring.de">Bildungsmonitoring</a>, <a href="https://www-genesis.destatis.de/genesis/online">Genesis</a>, <a href="https://www.landesdatenbank.nrw.de">Landesdatenbank NRW</a>, <a href="https://www.regionalstatistik.de/genesis/online">Regionalstatistik</a>), you need to register on the respective website. For this vignette, we use the Landesdatenbank NRW database, so please register an account there. Once you have registered, use <code><a href="https://rdrr.io/pkg/wiesbaden/man/save_credentials.html">wiesbaden::save_credentials</a></code> to save your login information and <code><a href="https://rdrr.io/pkg/wiesbaden/man/test_login.html">wiesbaden::test_login</a></code> to test the connection. If you cannot establish a valid connection, you will not be able to execute all subsequent code chunks!</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Save your credentials for the Landesdatenbank NRW</span></a>
<a class="sourceLine" id="cb2-2" title="2">wiesbaden<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/wiesbaden/man/save_credentials.html">save_credentials</a></span>(</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">db =</span> <span class="st">"nrw"</span>,                        <span class="co"># Do not change</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">user =</span> <span class="st">"YOUR USER NAME"</span>,           <span class="co"># Update with your account name</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="dt">password =</span> <span class="st">"YOUR PASSWORD"</span>         <span class="co"># Update with your password </span></a>
<a class="sourceLine" id="cb2-6" title="6">)</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co"># Test connection</span></a>
<a class="sourceLine" id="cb2-9" title="9">wiesbaden<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/wiesbaden/man/test_login.html">test_login</a></span>(</a>
<a class="sourceLine" id="cb2-10" title="10">   <span class="dt">genesis =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">db =</span> <span class="st">"nrw"</span>)</a>
<a class="sourceLine" id="cb2-11" title="11">   )</a></code></pre></div>
</div>
<div id="retrieving-data" class="section level1">
<h1 class="hasAnchor">
<a href="#retrieving-data" class="anchor"></a>Retrieving Data</h1>
<p>In this vignette, we are interested in tables with data on universities. On the Landesdatenbank NRW website, the code for tables on universities is “213”. So let us retrieve all table names with code “213”:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Retrieve all tables with code "213"</span></a>
<a class="sourceLine" id="cb3-2" title="2">df_table &lt;-<span class="st"> </span>wiesbaden<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_datalist.html">retrieve_datalist</a></span>(</a>
<a class="sourceLine" id="cb3-3" title="3">   <span class="dt">tableseries=</span> <span class="st">"213"</span>,</a>
<a class="sourceLine" id="cb3-4" title="4">   <span class="dt">genesis =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">db =</span> <span class="st">"nrw"</span>)</a>
<a class="sourceLine" id="cb3-5" title="5">   )</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">df_table <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">desc</span>(description)) <span class="op">%&gt;%</span><span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>()</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(df_table<span class="op">$</span>description)</a></code></pre></div>
<p>Looking at the retrieved data frame, a problem becomes apparent: the function not only returns tables that start with code “213” but all tables with the fragment “213” anywhere in their code. In addition to tables on universities, this returns tables on wastewater sewage, among other things. So let us filter the data frame to all table names whose code starts with “213”:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Filtering the tables to codes starting with "213".</span></a>
<a class="sourceLine" id="cb4-2" title="2">df_table_filtered &lt;-<span class="st"> </span>df_table <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb4-4" title="4">    stringr<span class="op">::</span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span>(</a>
<a class="sourceLine" id="cb4-5" title="5">      tablename,</a>
<a class="sourceLine" id="cb4-6" title="6">      <span class="st">"213"</span></a>
<a class="sourceLine" id="cb4-7" title="7">      )</a>
<a class="sourceLine" id="cb4-8" title="8">  )</a></code></pre></div>
<p>This looks much better, we now have a data frame with the names and descriptions of 37 tables with data on universities in NRW. In the next step, we are going to create a named vector of these table names using <code><a href="https://purrr.tidyverse.org/reference/set_names.html">purrr::set_names</a></code>. We then download the data for all table names in this vector and put them in one big data frame using a combination of <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_dfr</a></code> and <code><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_data.html">wiesbaden::retrieve_data</a></code>. You will be downloading a lot of data, so this step may take a while!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Get all table names and turn them into a named vector</span></a>
<a class="sourceLine" id="cb5-2" title="2">table_names &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span>(</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(</a>
<a class="sourceLine" id="cb5-4" title="4">    df_table_filtered[[<span class="st">"tablename"</span>]]</a>
<a class="sourceLine" id="cb5-5" title="5">  ),</a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="dt">nm =</span> <span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(</a>
<a class="sourceLine" id="cb5-7" title="7">      df_table_filtered[[<span class="st">"tablename"</span>]]</a>
<a class="sourceLine" id="cb5-8" title="8">      )</a>
<a class="sourceLine" id="cb5-9" title="9">  )</a>
<a class="sourceLine" id="cb5-10" title="10"></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co"># Retrieve data for every table name and bind them into one data frame. Note</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co"># that this may take a while!</span></a>
<a class="sourceLine" id="cb5-13" title="13">df &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(</a>
<a class="sourceLine" id="cb5-14" title="14">  table_names,</a>
<a class="sourceLine" id="cb5-15" title="15">  wiesbaden<span class="op">::</span>retrieve_data,</a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="dt">genesis =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">db =</span> <span class="st">"nrw"</span>),</a>
<a class="sourceLine" id="cb5-17" title="17">  <span class="dt">.id =</span> <span class="st">"tablename"</span></a>
<a class="sourceLine" id="cb5-18" title="18">  )</a></code></pre></div>
<p>For each table, we now download the available metadata with <code><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_metadata.html">wiesbaden::retrieve_metadata</a></code> and put them into one data frame using <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_dfr</a></code>. The metadata describes the different variables used in each table. The metadata consists of four columns: tablename, (variable) name, (variable) description and (variable) unit. We then create a character vector of the unique variable names for all tables.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Retrieve metadata for every table name and bind them into one data frame</span></a>
<a class="sourceLine" id="cb6-2" title="2">df_metadata &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(</a>
<a class="sourceLine" id="cb6-3" title="3">  table_names,</a>
<a class="sourceLine" id="cb6-4" title="4">  wiesbaden<span class="op">::</span>retrieve_metadata,</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">genesis =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">db =</span> <span class="st">"nrw"</span>),</a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="dt">.id =</span> <span class="st">"tablename"</span></a>
<a class="sourceLine" id="cb6-7" title="7">)</a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co"># Create character vector of all unique variable names in all tables</span></a>
<a class="sourceLine" id="cb6-10" title="10">variables_unique &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(</a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(</a>
<a class="sourceLine" id="cb6-12" title="12">    df_metadata[[<span class="st">"name"</span>]]</a>
<a class="sourceLine" id="cb6-13" title="13">    )</a>
<a class="sourceLine" id="cb6-14" title="14">  )</a></code></pre></div>
<p>We now have a vector of 30 unique variables that are used in the table series “213”. The data tables use value keys and not the actual value labels (e.g. the variable “SX-A01” has the two value keys “SX-OPSCHUL1” and “SX-OPSCHUL2” with the labels “Öffentlich” (<em>Public</em>) and “Privat” (<em>private</em>) stored in separate key tables). We use a combination of <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code> and <code><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_valuelabel.html">wiesbaden::retrieve_valuelabel</a></code> to retrieve all value labels for our data tables in a list. We then do some data cleaning using <code><a href="https://purrr.tidyverse.org/reference/keep.html">purrr::discard</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Retrieve value labels with wiesbaden::retrieve_valuelabel</span></a>
<a class="sourceLine" id="cb7-2" title="2">list_value_labels &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(</a>
<a class="sourceLine" id="cb7-3" title="3">  variables_unique,</a>
<a class="sourceLine" id="cb7-4" title="4">  wiesbaden<span class="op">::</span>retrieve_valuelabel,</a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="dt">genesis =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">db =</span> <span class="st">"nrw"</span>)</a>
<a class="sourceLine" id="cb7-6" title="6">  ) </a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co"># Variables with no labels return a list with the character "No results found."</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co"># We use purrr::discard to drop all these empty list elements of type character.</span></a>
<a class="sourceLine" id="cb7-10" title="10">list_value_labels_filtered &lt;-<span class="st"> </span>list_value_labels <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/keep.html">discard</a></span>(</a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/character.html">is.character</a></span>(.x)</a>
<a class="sourceLine" id="cb7-13" title="13">  )</a></code></pre></div>
<p>Unlike the downloaded data and metadata, which we have put into one data frame each, the value labels are put into a list of data frames. To retrieve a single element from that list, i.e. a single data frame of value labels, use double square brackets like this <code>list_value_labels_filtered[[1]]</code>.</p>
</div>
<div id="data-wrangling" class="section level1">
<h1 class="hasAnchor">
<a href="#data-wrangling" class="anchor"></a>Data Wrangling</h1>
<p>We now have all the data required and have done some minimal data cleaning and filtering. In this section, we clean the data some more and bring it all together in one data frame.</p>
<p>The Destatis data uses capitalized column names and column names containing hyphens. We automatically change this to snake case and replace special characters for all column names using <code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">janitor::clean_names</a></code>. The data also includes three types of columns that do not seem to be documented and which serve no apparent purpose. Specifically, the undocumented columns ending in “qual” (the only value being “e”), “err” (always 0) and “lock” (always NA) are of no value to us, so we discard them from the data frame.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># Clean all column names (e.g. replacing hyphens with underscores) and make them</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co"># use snake case.</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co"># Discard columns ending in "qual", "err", or "lock".</span></a>
<a class="sourceLine" id="cb8-4" title="4">df_cleaned &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="st">  </span>janitor<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span>(</a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="dt">case =</span> <span class="st">"snake"</span></a>
<a class="sourceLine" id="cb8-7" title="7">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(</a>
<a class="sourceLine" id="cb8-9" title="9">    <span class="op">-</span><span class="kw">ends_with</span>(</a>
<a class="sourceLine" id="cb8-10" title="10">      <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb8-11" title="11">        <span class="st">"qual"</span>,</a>
<a class="sourceLine" id="cb8-12" title="12">        <span class="st">"err"</span>, </a>
<a class="sourceLine" id="cb8-13" title="13">        <span class="st">"lock"</span></a>
<a class="sourceLine" id="cb8-14" title="14">        )</a>
<a class="sourceLine" id="cb8-15" title="15">      )</a>
<a class="sourceLine" id="cb8-16" title="16">    )</a></code></pre></div>
<p>We clean the list of value labels by turning all factors into character vectors using <code><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">dplyr::mutate_all</a></code>. Factors can be very useful, but I think it is easiest to use them selectively and only set them with a specific use case in mind. We then apply <code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">janitor::clean_names</a></code> to the list of data frames containing value labels. As we have also applied this function to the data frame with the actual data, this makes the column names between the different tables consistent.</p>
<p>We want to combine all value labels with the data frame containing the actual data. Unfortunately, each data frame with value labels has a column “description”. We need to make this column unique across the list of data frames containing value labels, so that we know which value key the description applies to. First, we use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_chr</a></code> to generate a character vector of the descriptions. This is then used as the input to another function, where we rename all the description columns to “description_” plus “key_id”.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Turn factors into character vectors and clean all column names with janitor</span></a>
<a class="sourceLine" id="cb9-2" title="2">list_value_labels_wrangled &lt;-<span class="st"> </span>list_value_labels_filtered <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(</a>
<a class="sourceLine" id="cb9-4" title="4">    dplyr<span class="op">::</span>mutate_all,</a>
<a class="sourceLine" id="cb9-5" title="5">    as.character</a>
<a class="sourceLine" id="cb9-6" title="6">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(</a>
<a class="sourceLine" id="cb9-8" title="8">    janitor<span class="op">::</span>clean_names,</a>
<a class="sourceLine" id="cb9-9" title="9">    <span class="dt">case =</span> <span class="st">"snake"</span></a>
<a class="sourceLine" id="cb9-10" title="10">  )</a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co"># Generate a character vector of unique description column names</span></a>
<a class="sourceLine" id="cb9-13" title="13">description_names &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(</a>
<a class="sourceLine" id="cb9-14" title="14">  purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(</a>
<a class="sourceLine" id="cb9-15" title="15">    list_value_labels_wrangled,</a>
<a class="sourceLine" id="cb9-16" title="16">    <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(.x), <span class="st">"_description"</span>)</a>
<a class="sourceLine" id="cb9-17" title="17">  ),</a>
<a class="sourceLine" id="cb9-18" title="18">  <span class="dv">1</span></a>
<a class="sourceLine" id="cb9-19" title="19">)</a>
<a class="sourceLine" id="cb9-20" title="20"></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co"># Rename the existing description column names to make them unique</span></a>
<a class="sourceLine" id="cb9-22" title="22">list_value_labels_unique &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span>(</a>
<a class="sourceLine" id="cb9-23" title="23">  list_value_labels_wrangled,</a>
<a class="sourceLine" id="cb9-24" title="24">  description_names,</a>
<a class="sourceLine" id="cb9-25" title="25">  <span class="op">~</span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(</a>
<a class="sourceLine" id="cb9-26" title="26">    .x,</a>
<a class="sourceLine" id="cb9-27" title="27">    <span class="op">!!</span><span class="dt">.y :=</span> description</a>
<a class="sourceLine" id="cb9-28" title="28">    )</a>
<a class="sourceLine" id="cb9-29" title="29">)</a></code></pre></div>
<p>We are now ready to combine the data with the corresponding labels. Before, though, we will retrieve another set of labels, describing the contents of each table. As with the value labels, we rename the generic “description” column to “tablename_description” to make it unique.</p>
<p>For combining tables that share a mutual key or mutal set of keys, we use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::left_join</a></code>. Because we have so many individual tables and keys, doing this manually would be tedious. To avoid this manual process, we use <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce</a></code> on a list of all data frames we want to join. So before applying <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce</a></code>, we put the data frame with the actual data, the data frame with the table descriptions, and the list of data frames containing value labels into one big list.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Create data frame with table name and table description</span></a>
<a class="sourceLine" id="cb10-2" title="2">df_table_descriptions &lt;-<span class="st"> </span>df_table_filtered <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span>(</a>
<a class="sourceLine" id="cb10-4" title="4">    as.character</a>
<a class="sourceLine" id="cb10-5" title="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(</a>
<a class="sourceLine" id="cb10-7" title="7">   tablename,</a>
<a class="sourceLine" id="cb10-8" title="8">   <span class="dt">tablename_description =</span> description</a>
<a class="sourceLine" id="cb10-9" title="9">  )</a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co"># Combine actual data with the data frame of table names and the list of data </span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co"># frames containing value labels into one list.</span></a>
<a class="sourceLine" id="cb10-13" title="13">df_list_tmp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/append.html">append</a></span>(</a>
<a class="sourceLine" id="cb10-14" title="14">  <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(df_cleaned),</a>
<a class="sourceLine" id="cb10-15" title="15">  <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(df_table_descriptions)</a>
<a class="sourceLine" id="cb10-16" title="16">)</a>
<a class="sourceLine" id="cb10-17" title="17"></a>
<a class="sourceLine" id="cb10-18" title="18">df_list &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/append.html">append</a></span>(</a>
<a class="sourceLine" id="cb10-19" title="19">  df_list_tmp,</a>
<a class="sourceLine" id="cb10-20" title="20">  list_value_labels_unique</a>
<a class="sourceLine" id="cb10-21" title="21">)</a>
<a class="sourceLine" id="cb10-22" title="22"></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co"># Join data with all the value label data frames to create one big data frame</span></a>
<a class="sourceLine" id="cb10-24" title="24">df_joined &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span>(</a>
<a class="sourceLine" id="cb10-25" title="25">  df_list,</a>
<a class="sourceLine" id="cb10-26" title="26">  dplyr<span class="op">::</span>left_join</a>
<a class="sourceLine" id="cb10-27" title="27">)</a></code></pre></div>
<p>We also sort the columns (not the rows!) alphabetically, so that the descriptions come immediately after the respective key column. The first two columns are always the table code and the table description. We also turn the data frame into a tibble, for better print defaults among other benefits.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Order columns alphabetically, put columns tablename and tablename_description </span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co"># first, put value columns last, turn data frame into tibble.</span></a>
<a class="sourceLine" id="cb11-3" title="3">db_nrw_<span class="dv">213</span> &lt;-<span class="st"> </span>df_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(</a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(</a>
<a class="sourceLine" id="cb11-6" title="6">      tidyselect<span class="op">::</span><span class="kw"><a href="https://tidyselect.r-lib.org/reference/peek_vars.html">peek_vars</a></span>()</a>
<a class="sourceLine" id="cb11-7" title="7">      )</a>
<a class="sourceLine" id="cb11-8" title="8">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span>(</a>
<a class="sourceLine" id="cb11-10" title="10">    tablename,</a>
<a class="sourceLine" id="cb11-11" title="11">    tablename_description,</a>
<a class="sourceLine" id="cb11-12" title="12">    <span class="op">!</span>(<span class="kw">ends_with</span>(<span class="st">"_val"</span>)),</a>
<a class="sourceLine" id="cb11-13" title="13">    <span class="kw">ends_with</span>(<span class="st">"val"</span>)</a>
<a class="sourceLine" id="cb11-14" title="14">    ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="st">  </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>()</a></code></pre></div>
<p>The resulting data frame, <code>db_nrw_213</code>, actually comes bundled with the <code>RUBer</code> package. We use <code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data</a></code> to handle this step for us. We have now added 37 tables of university related data to our package!</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">usethis<span class="op">::</span><span class="kw"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span>(</a>
<a class="sourceLine" id="cb12-2" title="2">  db_nrw_<span class="dv">213</span>,</a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="dt">overwrite =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="dt">version =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb12-5" title="5">  )</a></code></pre></div>
</div>
<div id="working-with-the-destatis-data" class="section level1">
<h1 class="hasAnchor">
<a href="#working-with-the-destatis-data" class="anchor"></a>Working with the Destatis data</h1>
<p>We usually do not want to work with the entire data frame at once. The RUBer package provides the function <code>filter_destatis_code</code>, which allows you to filter the data based on a table code. It also discards all columns that only consist of NA after filtering. As an example, let us create a data frame consisting of all data for table code “21311LS001A”.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/load.html">load</a></span>(</a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="st">"D:</span><span class="ch">\\</span><span class="st">Git</span><span class="ch">\\</span><span class="st">db_nrw_213.rda"</span></a>
<a class="sourceLine" id="cb13-3" title="3">)</a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co"># Get all rows and columns for table code 21311LS001A</span></a>
<a class="sourceLine" id="cb13-6" title="6">df_21311LS001A &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filter_destatis_code.html">filter_destatis_code</a></span>(</a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="dt">df =</span> db_nrw_<span class="dv">213</span>,</a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="dt">tablename =</span> <span class="st">"21311LS001A"</span></a>
<a class="sourceLine" id="cb13-9" title="9">  )</a></code></pre></div>
<p>The table description says that this table contains “Studierende / Studenten, Land, Hochschulen, Studienfach, Fachsemester, Angestrebte Abschlussprüfung, Semester”. So essentially it is a table of students for each degree program, term, and university. We will do some basic analysis and plotting using this data.</p>
<p>First, let us find out which five universities had the highest overall number of students with the help of <code><a href="https://forcats.tidyverse.org/reference/fct_lump.html">forcats::fct_lump_n</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Create data frame with plotting data, filtering on the winter term 2017/18,</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="co"># focusing on the top five universities in terms of student count and keeping</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co"># the top five degree types, in addition to a lumped category "other degrees".</span></a>
<a class="sourceLine" id="cb14-4" title="4">df_plot &lt;-<span class="st"> </span>df_21311LS001A <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb14-6" title="6">    semest <span class="op">==</span><span class="st"> "WS 2017/18"</span></a>
<a class="sourceLine" id="cb14-7" title="7">  ) <span class="op">%&gt;%</span><span class="st">   </span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb14-9" title="9">    <span class="dt">bilhs1_description =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(</a>
<a class="sourceLine" id="cb14-10" title="10">      bilhs1_description,</a>
<a class="sourceLine" id="cb14-11" title="11">      <span class="dt">n =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb14-12" title="12">      <span class="dt">w =</span> bil002_val,</a>
<a class="sourceLine" id="cb14-13" title="13">      <span class="dt">other_level =</span> <span class="st">"Other NRW universities"</span></a>
<a class="sourceLine" id="cb14-14" title="14">      )</a>
<a class="sourceLine" id="cb14-15" title="15">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-16" title="16"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb14-17" title="17">    bilhs1_description <span class="op">!=</span><span class="st"> "Other NRW universities"</span></a>
<a class="sourceLine" id="cb14-18" title="18">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-19" title="19"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb14-20" title="20">    <span class="dt">bilap1 =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(</a>
<a class="sourceLine" id="cb14-21" title="21">      bilap1,</a>
<a class="sourceLine" id="cb14-22" title="22">      <span class="dt">n =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb14-23" title="23">      <span class="dt">w =</span> bil002_val,</a>
<a class="sourceLine" id="cb14-24" title="24">      <span class="dt">other_level =</span> <span class="st">"Other degrees"</span></a>
<a class="sourceLine" id="cb14-25" title="25">      ),</a>
<a class="sourceLine" id="cb14-26" title="26">    <span class="dt">bilap1_description =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(</a>
<a class="sourceLine" id="cb14-27" title="27">      bilap1_description,</a>
<a class="sourceLine" id="cb14-28" title="28">      <span class="dt">n =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb14-29" title="29">      <span class="dt">w =</span> bil002_val,</a>
<a class="sourceLine" id="cb14-30" title="30">      <span class="dt">other_level =</span> <span class="st">"Other degrees"</span></a>
<a class="sourceLine" id="cb14-31" title="31">      )</a>
<a class="sourceLine" id="cb14-32" title="32">    )</a>
<a class="sourceLine" id="cb14-33" title="33"></a>
<a class="sourceLine" id="cb14-34" title="34"><span class="kw"><a href="../reference/rub_plot_type_1.html">rub_plot_type_1</a></span>(</a>
<a class="sourceLine" id="cb14-35" title="35">  <span class="dt">df =</span> df_plot,</a>
<a class="sourceLine" id="cb14-36" title="36">  <span class="dt">x_var =</span> bilhs1_description,</a>
<a class="sourceLine" id="cb14-37" title="37">  <span class="dt">y_var =</span> bil002_val,</a>
<a class="sourceLine" id="cb14-38" title="38">  <span class="dt">fill_var =</span> bilap1_description,</a>
<a class="sourceLine" id="cb14-39" title="39">  <span class="dt">y_axis_label =</span> <span class="st">"Students in winter term 2017/18"</span>,</a>
<a class="sourceLine" id="cb14-40" title="40">  <span class="dt">caption =</span> <span class="st">"Landesdatenbank NRW, Table Code 21311LS001A (license dl-de/by-2-0)"</span>,</a>
<a class="sourceLine" id="cb14-41" title="41">  <span class="dt">caption_prefix =</span> <span class="st">"Source:"</span>,</a>
<a class="sourceLine" id="cb14-42" title="42">  <span class="dt">filter_cutoff =</span> <span class="fl">0.06</span></a>
<a class="sourceLine" id="cb14-43" title="43"><span class="co">#  ,fill_reverse = TRUE</span></a>
<a class="sourceLine" id="cb14-44" title="44">)</a></code></pre></div>
<p><img src="Wiesbaden_files/figure-html/21311LS001A-plot1-1.png" width="700"></p>
<p>The Fernuniversität Hagen, the TH Aachen, the University of Bochum, the University of Köln and the University of Münster had the highest student count in the winter term 2017/18. Maybe we are interested more specifically in the relative importance of each degree type at each university. We can use <code>rub_plot_type_2</code> for that:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="../reference/rub_plot_type_2.html">rub_plot_type_2</a></span>(</a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="dt">df =</span> df_plot,</a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="dt">x_var =</span> bilhs1_description,</a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="dt">y_var =</span> bil002_val,</a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="dt">y_axis_label =</span> <span class="st">"Students in winter term 2017/18"</span>,</a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="dt">fill_var =</span> bilap1_description,</a>
<a class="sourceLine" id="cb15-7" title="7">  <span class="dt">caption =</span> <span class="st">"Landesdatenbank NRW, Table Code 21311LS001A (license dl-de/by-2-0)"</span>,</a>
<a class="sourceLine" id="cb15-8" title="8">  <span class="dt">caption_prefix =</span> <span class="st">"Source:"</span>,</a>
<a class="sourceLine" id="cb15-9" title="9">  <span class="dt">filter_cutoff =</span> <span class="fl">0.05</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co"># ,fill_reverse = TRUE</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co"># ,palette_reverse = TRUE</span></a>
<a class="sourceLine" id="cb15-12" title="12">)</a></code></pre></div>
<p><img src="Wiesbaden_files/figure-html/21311LS001A-plot2-1.png" width="700"></p>
<p>If we wanted to examine how the relative importance of each degree has developed over time, we could switch to <code>rub_plot_type_3</code> (a rotated version of type 2), use the term as y-variable and the university name as facet variable.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># Create data frame with plotting data, filtering on the winter terms 2013-2018,</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co"># focusing on the top five universities in terms of student count and keeping</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co"># the top five degree types, in addition to a lumped category "other degrees".</span></a>
<a class="sourceLine" id="cb16-4" title="4">df_plot_t3 &lt;-<span class="st"> </span>df_21311LS001A <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb16-6" title="6">    semest <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb16-7" title="7">      <span class="st">"WS 2017/18"</span>,</a>
<a class="sourceLine" id="cb16-8" title="8">      <span class="st">"WS 2016/17"</span>,</a>
<a class="sourceLine" id="cb16-9" title="9">      <span class="st">"WS 2015/16"</span>,</a>
<a class="sourceLine" id="cb16-10" title="10">      <span class="st">"WS 2014/15"</span>,</a>
<a class="sourceLine" id="cb16-11" title="11">      <span class="st">"WS 2013/14"</span></a>
<a class="sourceLine" id="cb16-12" title="12">      )</a>
<a class="sourceLine" id="cb16-13" title="13">    ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb16-15" title="15">    <span class="dt">bilhs1_description =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(</a>
<a class="sourceLine" id="cb16-16" title="16">      bilhs1_description,</a>
<a class="sourceLine" id="cb16-17" title="17">      <span class="dt">n =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb16-18" title="18">      <span class="dt">w =</span> bil002_val,</a>
<a class="sourceLine" id="cb16-19" title="19">      <span class="dt">other_level =</span> <span class="st">"Other NRW universities"</span></a>
<a class="sourceLine" id="cb16-20" title="20">      )</a>
<a class="sourceLine" id="cb16-21" title="21">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-22" title="22"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb16-23" title="23">    bilhs1_description <span class="op">!=</span><span class="st"> "Other NRW universities"</span></a>
<a class="sourceLine" id="cb16-24" title="24">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-25" title="25"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb16-26" title="26">    <span class="dt">bilap1 =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(</a>
<a class="sourceLine" id="cb16-27" title="27">      bilap1,</a>
<a class="sourceLine" id="cb16-28" title="28">      <span class="dt">n =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb16-29" title="29">      <span class="dt">w =</span> bil002_val,</a>
<a class="sourceLine" id="cb16-30" title="30">      <span class="dt">other_level =</span> <span class="st">"Other degrees"</span></a>
<a class="sourceLine" id="cb16-31" title="31">      ),</a>
<a class="sourceLine" id="cb16-32" title="32">    <span class="dt">bilap1_description =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(</a>
<a class="sourceLine" id="cb16-33" title="33">      bilap1_description,</a>
<a class="sourceLine" id="cb16-34" title="34">      <span class="dt">n =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb16-35" title="35">      <span class="dt">w =</span> bil002_val,</a>
<a class="sourceLine" id="cb16-36" title="36">      <span class="dt">other_level =</span> <span class="st">"Other degrees"</span></a>
<a class="sourceLine" id="cb16-37" title="37">      )</a>
<a class="sourceLine" id="cb16-38" title="38">    )</a>
<a class="sourceLine" id="cb16-39" title="39"></a>
<a class="sourceLine" id="cb16-40" title="40"><span class="kw"><a href="../reference/rub_plot_type_3.html">rub_plot_type_3</a></span>(</a>
<a class="sourceLine" id="cb16-41" title="41">  <span class="dt">df =</span> df_plot_t3,</a>
<a class="sourceLine" id="cb16-42" title="42">  <span class="dt">x_var =</span> bil002_val,</a>
<a class="sourceLine" id="cb16-43" title="43">  <span class="dt">y_var =</span> semest,</a>
<a class="sourceLine" id="cb16-44" title="44">  <span class="dt">facet_var =</span> bilhs1_description,</a>
<a class="sourceLine" id="cb16-45" title="45">  <span class="dt">fill_var =</span> bilap1_description,</a>
<a class="sourceLine" id="cb16-46" title="46">  <span class="dt">caption =</span> <span class="st">"Landesdatenbank NRW, Table Code 21311LS001A (license dl-de/by-2-0)"</span>,</a>
<a class="sourceLine" id="cb16-47" title="47">  <span class="dt">caption_prefix =</span> <span class="st">"Source:"</span>,</a>
<a class="sourceLine" id="cb16-48" title="48">  <span class="dt">filter_cutoff =</span> <span class="fl">0.06</span></a>
<a class="sourceLine" id="cb16-49" title="49">  ,<span class="dt">fill_reverse =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb16-50" title="50">)</a></code></pre></div>
<p><img src="Wiesbaden_files/figure-html/21311LS001A-plot3-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"></a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co"># rub_plot_type_3(</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co">#   df = df_plot_t3,</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co">#   x_var = bil002_val,</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co">#   y_var = semest,</span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">#   facet_var = bilhs1_description,</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">#   fill_label = bilap1_description,</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="co">#   fill_var = bilap1,</span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">#   caption = "Landesdatenbank NRW, Table Code 21311LS001A (license dl-de/by-2-0)",</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co">#   caption_prefix = "Source:",</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co">#   filter_cutoff = 0.06</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="co">#   ,fill_reverse = FALSE</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="co"># )</span></a></code></pre></div>
</div>
<div id="data-license-for-the-destatis-data" class="section level1">
<h1 class="hasAnchor">
<a href="#data-license-for-the-destatis-data" class="anchor"></a>Data license for the Destatis data</h1>
<p>Data obtained from Destatis is available under the <a href="www.govdata.de/dl-de/by-2-0">Data licence Germany – attribution – version 2.0 (dl-de/by-2-0)</a>. The data in this vignette was obtained from the Landesdatenbank NRW using the code “213” for “Hochschulen”. The license requests a reference to the dataset using the URI. To the best of my knowledge, the Landesdatenbank NRW does not yet provide Uniform Resource Identifiers (URI) to identify these tables.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#wiesbaden-setup">Wiesbaden Setup</a></li>
      <li><a href="#retrieving-data">Retrieving Data</a></li>
      <li><a href="#data-wrangling">Data Wrangling</a></li>
      <li><a href="#working-with-the-destatis-data">Working with the Destatis data</a></li>
      <li><a href="#data-license-for-the-destatis-data">Data license for the Destatis data</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Richard Meyer-Eppler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
